<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Game - Multiplayer Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.1);
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #3a0ca3, #4361ee);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: white;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(26, 26, 46, 0.85);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        header {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px 40px;
            text-align: center;
            border-bottom: 3px solid var(--success);
            position: relative;
        }

        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 15px;
            display: flex;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .lang-option {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        .lang-option.active {
            background: var(--primary);
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4cc9f0, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .game-section {
            display: none;
            padding: 30px 40px;
        }

        .active {
            display: block;
        }

        .form-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--success);
            font-size: 1.1rem;
        }

        input, select, button {
            width: 100%;
            padding: 16px 20px;
            border-radius: 12px;
            border: none;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.08);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--success);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 4px rgba(76, 201, 240, 0.2);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        button {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            font-size: 1.2rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        button:after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20%;
            height: 200%;
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(25deg);
            transition: all 0.5s;
        }

        button:hover:after {
            left: 120%;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(67, 97, 238, 0.4);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-danger {
            background: linear-gradient(90deg, var(--danger), #d00070);
        }

        .btn-danger:hover {
            box-shadow: 0 7px 20px rgba(247, 37, 133, 0.4);
        }

        .btn-warning {
            background: linear-gradient(90deg, var(--warning), #e85d04);
        }

        .btn-warning:hover {
            box-shadow: 0 7px 20px rgba(248, 150, 30, 0.4);
        }

        .code-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            border: 2px solid var(--success);
            position: relative;
        }

        .code-display h3 {
            color: var(--success);
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .code-value {
            font-size: 3.5rem;
            letter-spacing: 10px;
            font-weight: 800;
            background: linear-gradient(90deg, #f72585, #4361ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            font-family: monospace;
        }

        .player-list {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid var(--primary);
        }

        .player-list h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--success);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .players-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .player-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            min-width: 180px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .player-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--success);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s;
        }

        .player-card:hover:before {
            transform: scaleX(1);
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .player-card.host:after {
            content: "👑";
            position: absolute;
            top: -12px;
            right: -12px;
            background: var(--warning);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .player-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-icon {
            font-size: 1.2rem;
        }

        .status-pending {
            color: var(--warning);
        }

        .status-submitted {
            color: var(--success);
        }

        .timer {
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid var(--danger);
        }

        .timer h3 {
            color: var(--warning);
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .timer-value {
            font-size: 4rem;
            font-weight: 800;
            color: var(--danger);
            text-shadow: 0 0 15px rgba(247, 37, 133, 0.6);
            font-family: monospace;
            margin: 10px 0;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s;
        }

        .category-card:hover:before {
            transform: scaleX(1);
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .category-card h4 {
            color: var(--success);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .answers-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            border: 2px solid var(--success);
            display: none;
        }

        .answers-display h3 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--warning);
            font-size: 1.8rem;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .answer-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .answer-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary);
        }

        .answer-card h4 {
            color: var(--success);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .answer-card p {
            font-size: 1.2rem;
            color: white;
            font-weight: 500;
        }

        .status-message {
            padding: 18px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            font-weight: 600;
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status-success {
            background: rgba(46, 204, 113, 0.15);
            border: 2px solid #2ecc71;
            color: #2ecc71;
        }

        .status-error {
            background: rgba(231, 76, 60, 0.15);
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }

        .status-info {
            background: rgba(52, 152, 219, 0.15);
            border: 2px solid #3498db;
            color: #3498db;
        }

        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--success), var(--primary), transparent);
            margin: 40px 0;
            border-radius: 2px;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .instructions h3 {
            color: var(--warning);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .instructions ul {
            padding-left: 30px;
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 15px;
            font-size: 1.1rem;
            position: relative;
        }

        .instructions li:before {
            content: '•';
            color: var(--success);
            font-size: 1.5rem;
            position: absolute;
            left: -25px;
            top: -3px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .game-header .info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-header .timer {
            margin: 0;
            flex: 1;
            max-width: 300px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-left: 5px solid var(--success);
            border-radius: 8px;
            padding: 15px 20px;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            transform: translateX(110%);
            transition: transform 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            font-size: 1.8rem;
            color: var(--success);
        }

        .notification-content {
            flex: 1;
        }

        .notification h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .notification p {
            font-size: 1rem;
            opacity: 0.8;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .notification-close:hover {
            opacity: 1;
        }

        @media (max-width: 992px) {
            .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }
            
            .code-value {
                font-size: 2.5rem;
                letter-spacing: 6px;
            }
            
            .game-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .game-header .timer {
                max-width: 100%;
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .answers-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 20px;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .game-section {
                padding: 20px;
            }
            
            .code-value {
                font-size: 2rem;
            }
            
            .player-card {
                min-width: 140px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Notification container -->
    <div id="notification-container"></div>
    
    <div class="container">
        <header>
            <div class="language-toggle" id="language-toggle">
                <div class="lang-option active" data-lang="en">English</div>
                <div class="lang-option" data-lang="ar">العربية</div>
            </div>
            
            <h1><i class="fas fa-puzzle-piece"></i> <span data-translate="game_title">Connection Game</span></h1>
            <p><span data-translate="game_description">Connect with friends and test your creativity in this multiplayer challenge!</span></p>
        </header>
        
        <!-- Host/Join Section -->
        <div id="host-section" class="game-section active">
            <div class="form-container">
                <div class="form-group">
                    <label for="player-name"><i class="fas fa-user"></i> <span data-translate="your_name">Your Name</span></label>
                    <input type="text" id="player-name" placeholder="Enter your name">
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> <span data-translate="how_to_play">How to Play</span></h3>
                    <ul>
                        <li><span data-translate="instruction1">Host creates a game and shares the code with friends</span></li>
                        <li><span data-translate="instruction2">Players enter the code to join the game</span></li>
                        <li><span data-translate="instruction3">Once all players join, host starts the game</span></li>
                        <li><span data-translate="instruction4">Answer all 10 categories before time runs out</span></li>
                        <li><span data-translate="instruction5">Compare answers and see who made the best connections!</span></li>
                    </ul>
                </div>
                
                <div class="divider"></div>
                
                <h2 style="text-align: center; margin: 25px 0; color: var(--success);" data-translate="host_game">Host a New Game</h2>
                
                <div class="form-group">
                    <label for="player-count"><i class="fas fa-users"></i> <span data-translate="num_players">Number of Players</span></label>
                    <select id="player-count">
                        <option value="2">2 <span data-translate="players">Players</span></option>
                        <option value="3">3 <span data-translate="players">Players</span></option>
                        <option value="4" selected>4 <span data-translate="players">Players</span></option>
                        <option value="5">5 <span data-translate="players">Players</span></option>
                        <option value="6">6 <span data-translate="players">Players</span></option>
                    </select>
                </div>
                
                <button id="host-game">
                    <i class="fas fa-plus-circle"></i> <span data-translate="create_game">Create Game</span>
                </button>
                
                <div class="divider"></div>
                
                <h2 style="text-align: center; margin: 25px 0; color: var(--primary);" data-translate="join_game">Join Existing Game</h2>
                
                <div class="form-group">
                    <label for="join-code"><i class="fas fa-gamepad"></i> <span data-translate="game_code">Game Code</span></label>
                    <input type="text" id="join-code" placeholder="Enter 6-digit game code">
                </div>
                
                <button id="join-game">
                    <i class="fas fa-sign-in-alt"></i> <span data-translate="join_game">Join Game</span>
                </button>
            </div>
        </div>
        
        <!-- Lobby Section -->
        <div id="lobby-section" class="game-section">
            <div class="code-display">
                <h3><i class="fas fa-qrcode"></i> <span data-translate="game_code">Game Code</span></h3>
                <div class="code-value" id="game-code-display">A1B2C3</div>
                <p><span data-translate="share_code">Share this code with other players to join</span></p>
            </div>
            
            <div class="player-list">
                <h3><i class="fas fa-users"></i> <span data-translate="players_lobby">Players in Lobby</span></h3>
                <div class="players-container" id="players-container">
                    <!-- Players will be added dynamically -->
                </div>
            </div>
            
            <div id="host-controls" style="display: flex; gap: 20px; margin-top: 30px;">
                <button id="start-game" style="flex: 1;">
                    <i class="fas fa-play"></i> <span data-translate="start_game">Start Game</span>
                </button>
                <button id="cancel-game" class="btn-danger" style="flex: 1;">
                    <i class="fas fa-times"></i> <span data-translate="cancel_game">Cancel Game</span>
                </button>
            </div>
            
            <div id="player-waiting" style="text-align: center; padding: 30px; font-size: 1.3rem; background: rgba(0,0,0,0.3); border-radius: 15px; margin-top: 30px; display: none;">
                <p><i class="fas fa-hourglass-half"></i> <span data-translate="waiting_host">Waiting for host to start the game...</span></p>
            </div>
            
            <div class="timer" id="cancel-timer" style="display: none;">
                <h3><i class="fas fa-exclamation-triangle"></i> <span data-translate="cancellation">Game Cancellation</span></h3>
                <div class="timer-value">30</div>
                <p><span data-translate="cancellation_desc">Game will be cancelled when timer reaches zero</span></p>
            </div>
        </div>
        
        <!-- Game Section -->
        <div id="game-section" class="game-section">
            <div class="game-header">
                <div class="info">
                    <h2 style="color: var(--success);"><span data-translate="game_code">Game Code</span>: <span id="current-game-code">A1B2C3</span></h2>
                    <p style="font-size: 1.2rem; margin-top: 10px;"><span data-translate="players">Players</span>: <span id="current-player-count">4</span>/<span id="max-player-count">4</span></p>
                </div>
                
                <div class="timer">
                    <h3><i class="fas fa-clock"></i> <span data-translate="time_remaining">Time Remaining</span></h3>
                    <div class="timer-value">180</div>
                </div>
            </div>
            
            <div class="categories-grid">
                <div class="category-card">
                    <h4><i class="fas fa-male"></i> <span data-translate="boys_name">Boy's Name</span></h4>
                    <input type="text" id="boy-name" placeholder="Enter a boy's name">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-female"></i> <span data-translate="girls_name">Girl's Name</span></h4>
                    <input type="text" id="girl-name" placeholder="Enter a girl's name">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-apple-alt"></i> <span data-translate="fruit">Fruit</span></h4>
                    <input type="text" id="fruit" placeholder="Enter a fruit">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-carrot"></i> <span data-translate="vegetable">Vegetable</span></h4>
                    <input type="text" id="vegetable" placeholder="Enter a vegetable">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-couch"></i> <span data-translate="object">Inanimate Object</span></h4>
                    <input type="text" id="object" placeholder="Enter an object">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-paw"></i> <span data-translate="animal">Animal</span></h4>
                    <input type="text" id="animal" placeholder="Enter an animal">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-briefcase"></i> <span data-translate="profession">Profession</span></h4>
                    <input type="text" id="profession" placeholder="Enter a profession">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-city"></i> <span data-translate="city">City</span></h4>
                    <input type="text" id="city" placeholder="Enter a city">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-globe-americas"></i> <span data-translate="country">Country</span></h4>
                    <input type="text" id="country" placeholder="Enter a country">
                </div>
                
                <div class="category-card">
                    <h4><i class="fas fa-tshirt"></i> <span data-translate="clothing">Clothing</span></h4>
                    <input type="text" id="clothing" placeholder="Enter clothing item">
                </div>
            </div>
            
            <button id="submit-answers">
                <i class="fas fa-paper-plane"></i> <span data-translate="submit_answers">Submit Answers</span>
            </button>
            
            <div class="player-list">
                <h3><i class="fas fa-user-check"></i> <span data-translate="submission_status">Submission Status</span></h3>
                <div class="players-container" id="submission-container">
                    <!-- Submission status will be added dynamically -->
                </div>
            </div>
            
            <div class="answers-display" id="answers-display">
                <h3><i class="fas fa-check-circle"></i> <span data-translate="your_answers">Your Submitted Answers</span></h3>
                <div class="answers-grid" id="answers-grid">
                    <!-- Answers will be added dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Status Messages -->
        <div id="status-message" class="status-message"></div>
    </div>
    
    <script>
        // Backend URL
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycby5wg6KePWqbAvaEJh5XIIaDzL0bSw9duLEo7jfZ2ODw1uw4vzWOAJvj2oa__S2_BDKCw/exec';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Game state variables
            let gameCode = '';
            let playerName = '';
            let isHost = false;
            let players = [];
            let timer = null;
            let timeLeft = 30;
            let gameTimer = null;
            let gameTime = 180;
            let lobbyInterval = null;
            let currentLanguage = 'en';
            
            // Translations
            const translations = {
                en: {
                    game_title: "Connection Game",
                    game_description: "Connect with friends and test your creativity in this multiplayer challenge!",
                    your_name: "Your Name",
                    how_to_play: "How to Play",
                    instruction1: "Host creates a game and shares the code with friends",
                    instruction2: "Players enter the code to join the game",
                    instruction3: "Once all players join, host starts the game",
                    instruction4: "Answer all 10 categories before time runs out",
                    instruction5: "Compare answers and see who made the best connections!",
                    host_game: "Host a New Game",
                    num_players: "Number of Players",
                    players: "Players",
                    create_game: "Create Game",
                    join_game: "Join Existing Game",
                    game_code: "Game Code",
                    join_game_btn: "Join Game",
                    share_code: "Share this code with other players to join",
                    players_lobby: "Players in Lobby",
                    start_game: "Start Game",
                    cancel_game: "Cancel Game",
                    waiting_host: "Waiting for host to start the game...",
                    cancellation: "Game Cancellation",
                    cancellation_desc: "Game will be cancelled when timer reaches zero",
                    time_remaining: "Time Remaining",
                    boys_name: "Boy's Name",
                    girls_name: "Girl's Name",
                    fruit: "Fruit",
                    vegetable: "Vegetable",
                    object: "Inanimate Object",
                    animal: "Animal",
                    profession: "Profession",
                    city: "City",
                    country: "Country",
                    clothing: "Clothing",
                    submit_answers: "Submit Answers",
                    submission_status: "Submission Status",
                    your_answers: "Your Submitted Answers",
                    player_submitted: "has submitted answers!",
                    you_submitted: "You submitted answers!",
                    submitted: "Submitted",
                    pending: "Pending"
                },
                ar: {
                    game_title: "لعبة الاتصال",
                    game_description: "تواصل مع الأصدقاء واختبر إبداعك في هذا التحدي الجماعي!",
                    your_name: "اسمك",
                    how_to_play: "كيفية اللعب",
                    instruction1: "ينشئ المضيف لعبة ويشارك الرمز مع الأصدقاء",
                    instruction2: "يدخل اللاعبون الرمز للانضمام إلى اللعبة",
                    instruction3: "بمجرد انضمام جميع اللاعبين، يبدأ المضيف اللعبة",
                    instruction4: "أجب على جميع الفئات العشرة قبل انتهاء الوقت",
                    instruction5: "قارن الإجابات وانظر من صنع أفضل الاتصالات!",
                    host_game: "استضافة لعبة جديدة",
                    num_players: "عدد اللاعبين",
                    players: "لاعبين",
                    create_game: "إنشاء لعبة",
                    join_game: "الانضمام إلى لعبة موجودة",
                    game_code: "رمز اللعبة",
                    join_game_btn: "انضم إلى اللعبة",
                    share_code: "شارك هذا الرمز مع اللاعبين الآخرين للانضمام",
                    players_lobby: "اللاعبون في الردهة",
                    start_game: "بدء اللعبة",
                    cancel_game: "إلغاء اللعبة",
                    waiting_host: "في انتظار المضيف لبدء اللعبة...",
                    cancellation: "إلغاء اللعبة",
                    cancellation_desc: "سيتم إلغاء اللعبة عندما يصل المؤقت إلى الصفر",
                    time_remaining: "الوقت المتبقي",
                    boys_name: "اسم ولد",
                    girls_name: "اسم بنت",
                    fruit: "فاكهة",
                    vegetable: "خضار",
                    object: "شيء غير حي",
                    animal: "حيوان",
                    profession: "مهنة",
                    city: "مدينة",
                    country: "دولة",
                    clothing: "ملابس",
                    submit_answers: "تقديم الإجابات",
                    submission_status: "حالة التقديم",
                    your_answers: "إجاباتك المقدمة",
                    player_submitted: "قام بتقديم الإجابات!",
                    you_submitted: "لقد قدمت إجاباتك!",
                    submitted: "تم التقديم",
                    pending: "قيد الانتظار"
                }
            };
            
            // DOM elements
            const hostSection = document.getElementById('host-section');
            const lobbySection = document.getElementById('lobby-section');
            const gameSection = document.getElementById('game-section');
            const statusMessage = document.getElementById('status-message');
            const gameCodeDisplay = document.getElementById('game-code-display');
            const playersContainer = document.getElementById('players-container');
            const submissionContainer = document.getElementById('submission-container');
            const hostControls = document.getElementById('host-controls');
            const playerWaiting = document.getElementById('player-waiting');
            const cancelTimer = document.getElementById('cancel-timer');
            const timerValue = cancelTimer.querySelector('.timer-value');
            const currentGameCode = document.getElementById('current-game-code');
            const answersDisplay = document.getElementById('answers-display');
            const answersGrid = document.getElementById('answers-grid');
            const gameTimerValue = document.querySelector('#game-section .timer-value');
            const languageToggle = document.getElementById('language-toggle');
            
            // Buttons
            document.getElementById('host-game').addEventListener('click', hostNewGame);
            document.getElementById('join-game').addEventListener('click', joinExistingGame);
            document.getElementById('start-game').addEventListener('click', startGame);
            document.getElementById('cancel-game').addEventListener('click', startCancelCountdown);
            document.getElementById('submit-answers').addEventListener('click', submitAnswers);
            
            // Language toggle
            languageToggle.addEventListener('click', function(e) {
                if (e.target.classList.contains('lang-option')) {
                    // Update active language
                    document.querySelectorAll('.lang-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    
                    // Set new language
                    currentLanguage = e.target.dataset.lang;
                    
                    // Update page direction
                    document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
                    
                    // Apply translations
                    applyTranslations();
                }
            });
            
            // Initialize the game
            init();
            
            function init() {
                // Set up initial UI state
                hostControls.style.display = 'none';
                playerWaiting.style.display = 'none';
                cancelTimer.style.display = 'none';
                answersDisplay.style.display = 'none';
                
                // Generate a sample game code for display
                gameCode = generateGameCode();
                gameCodeDisplay.textContent = gameCode;
                currentGameCode.textContent = gameCode;
                
                // Apply initial translations
                applyTranslations();
            }
            
            function applyTranslations() {
                // Update all translatable elements
                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.dataset.translate;
                    if (translations[currentLanguage][key]) {
                        el.textContent = translations[currentLanguage][key];
                    }
                });
                
                // Update placeholders and buttons with dynamic content
                const placeholderTexts = {
                    'player-name': translations[currentLanguage]['your_name'],
                    'join-code': translations[currentLanguage]['game_code'],
                    'boy-name': translations[currentLanguage]['boys_name'],
                    'girl-name': translations[currentLanguage]['girls_name'],
                    'fruit': translations[currentLanguage]['fruit'],
                    'vegetable': translations[currentLanguage]['vegetable'],
                    'object': translations[currentLanguage]['object'],
                    'animal': translations[currentLanguage]['animal'],
                    'profession': translations[currentLanguage]['profession'],
                    'city': translations[currentLanguage]['city'],
                    'country': translations[currentLanguage]['country'],
                    'clothing': translations[currentLanguage]['clothing']
                };
                
                for (const [id, text] of Object.entries(placeholderTexts)) {
                    const el = document.getElementById(id);
                    if (el) {
                        el.placeholder = currentLanguage === 'en' 
                            ? `Enter ${text.toLowerCase()}` 
                            : `أدخل ${text}`;
                    }
                }
            }
            
            function showSection(sectionId) {
                // Hide all sections
                document.querySelectorAll('.game-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show the requested section
                document.getElementById(sectionId).classList.add('active');
            }
            
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                statusMessage.classList.add(`status-${type}`);
                statusMessage.style.display = 'block';
                
                // Hide the message after 4 seconds
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 4000);
            }
            
            function showNotification(playerName, isSelf = false) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="notification-content">
                        <h4>${isSelf ? translations[currentLanguage]['you_submitted'] : playerName + ' ' + translations[currentLanguage]['player_submitted']}</h4>
                        <p>${new Date().toLocaleTimeString()}</p>
                    </div>
                    <button class="notification-close">&times;</button>
                `;
                
                document.getElementById('notification-container').appendChild(notification);
                
                // Show notification
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                // Close button
                notification.querySelector('.notification-close').addEventListener('click', function() {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 500);
                });
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.classList.remove('show');
                        setTimeout(() => {
                            notification.remove();
                        }, 500);
                    }
                }, 5000);
            }
            
            function generateGameCode() {
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ123456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            }
            
            async function callBackend(action, params = {}) {
                try {
                    // Build URL with parameters
                    let url = `${BACKEND_URL}?action=${action}`;
                    for (const [key, value] of Object.entries(params)) {
                        url += `&${key}=${encodeURIComponent(value)}`;
                    }
                    
                    // Call the backend
                    const response = await fetch(url, {
                        method: 'POST',
                        redirect: 'follow'
                    });
                    
                    // Parse the response
                    const result = await response.json();
                    
                    if (!result.success) {
                        showStatus(result.message || 'An error occurred', 'error');
                    }
                    
                    return result;
                } catch (error) {
                    console.error('Backend call failed:', error);
                    showStatus('Connection error. Please try again.', 'error');
                    return { success: false, message: 'Connection error' };
                }
            }
            
            async function hostNewGame() {
                playerName = document.getElementById('player-name').value.trim();
                const playerCount = document.getElementById('player-count').value;
                
                if (!playerName) {
                    showStatus(translations[currentLanguage]['your_name'] + ' ' + translations[currentLanguage]['required'], 'error');
                    return;
                }
                
                // Call backend to host game
                const result = await callBackend('hostGame', {
                    hostName: playerName,
                    playerCount: playerCount
                });
                
                if (!result.success) return;
                
                // Update game state
                gameCode = result.gameCode;
                isHost = true;
                players = [playerName];
                
                // Update UI
                updatePlayerList();
                updateSubmissionStatus();
                gameCodeDisplay.textContent = gameCode;
                currentGameCode.textContent = gameCode;
                document.getElementById('current-player-count').textContent = result.playerCount;
                document.getElementById('max-player-count').textContent = result.maxPlayers;
                showSection('lobby-section');
                hostControls.style.display = 'flex';
                playerWaiting.style.display = 'none';
                
                // Start polling for lobby updates
                startLobbyPolling();
                
                showStatus(translations[currentLanguage]['game_created'], 'success');
            }
            
            async function joinExistingGame() {
                playerName = document.getElementById('player-name').value.trim();
                const joinCode = document.getElementById('join-code').value.trim().toUpperCase();
                
                if (!playerName) {
                    showStatus(translations[currentLanguage]['your_name'] + ' ' + translations[currentLanguage]['required'], 'error');
                    return;
                }
                
                if (!joinCode || joinCode.length !== 6) {
                    showStatus(translations[currentLanguage]['invalid_code'], 'error');
                    return;
                }
                
                // Call backend to join game
                const result = await callBackend('joinGame', {
                    gameCode: joinCode,
                    playerName: playerName
                });
                
                if (!result.success) return;
                
                // Update game state
                gameCode = result.gameCode;
                isHost = false;
                players = result.players || [result.hostName, playerName];
                
                // Update UI
                updatePlayerList();
                updateSubmissionStatus();
                gameCodeDisplay.textContent = gameCode;
                currentGameCode.textContent = gameCode;
                document.getElementById('current-player-count').textContent = result.playerCount;
                document.getElementById('max-player-count').textContent = result.maxPlayers;
                showSection('lobby-section');
                hostControls.style.display = 'none';
                playerWaiting.style.display = 'block';
                
                // Start polling for lobby updates
                startLobbyPolling();
                
                showStatus(translations[currentLanguage]['game_joined'], 'success');
            }
            
            function updatePlayerList() {
                playersContainer.innerHTML = '';
                
                players.forEach((player, index) => {
                    const playerCard = document.createElement('div');
                    playerCard.className = 'player-card';
                    playerCard.innerHTML = `
                        <div>${player}</div>
                        <div class="player-status">
                            <i class="fas fa-hourglass-half status-icon status-pending"></i>
                            <span>${translations[currentLanguage]['pending']}</span>
                        </div>
                    `;
                    
                    if (index === 0) {
                        playerCard.classList.add('host');
                    }
                    
                    playersContainer.appendChild(playerCard);
                });
            }
            
            function updateSubmissionStatus() {
                submissionContainer.innerHTML = '';
                
                players.forEach((player, index) => {
                    const playerCard = document.createElement('div');
                    playerCard.className = 'player-card';
                    playerCard.innerHTML = `
                        <div>${player}</div>
                        <div class="player-status">
                            <i class="fas fa-hourglass-half status-icon status-pending"></i>
                            <span>${translations[currentLanguage]['pending']}</span>
                        </div>
                    `;
                    
                    if (index === 0) {
                        playerCard.classList.add('host');
                    }
                    
                    submissionContainer.appendChild(playerCard);
                });
            }
            
            function markPlayerSubmitted(playerName) {
                // Update player status in lobby
                const playerCards = playersContainer.querySelectorAll('.player-card');
                playerCards.forEach(card => {
                    if (card.textContent.includes(playerName)) {
                        const statusDiv = card.querySelector('.player-status');
                        statusDiv.innerHTML = `
                            <i class="fas fa-check-circle status-icon status-submitted"></i>
                            <span>${translations[currentLanguage]['submitted']}</span>
                        `;
                    }
                });
                
                // Update player status in game section
                const submissionCards = submissionContainer.querySelectorAll('.player-card');
                submissionCards.forEach(card => {
                    if (card.textContent.includes(playerName)) {
                        const statusDiv = card.querySelector('.player-status');
                        statusDiv.innerHTML = `
                            <i class="fas fa-check-circle status-icon status-submitted"></i>
                            <span>${translations[currentLanguage]['submitted']}</span>
                        `;
                    }
                });
            }
            
            async function startLobbyPolling() {
                // Clear any existing interval
                if (lobbyInterval) clearInterval(lobbyInterval);
                
                // Poll every 3 seconds
                lobbyInterval = setInterval(async () => {
                    const result = await callBackend('getGameState', {
                        gameCode: gameCode
                    });
                    
                    if (result && result.success) {
                        // Update player list
                        players = result.players || players;
                        updatePlayerList();
                        updateSubmissionStatus();
                        
                        // Update player counts
                        document.getElementById('current-player-count').textContent = players.length;
                        
                        // Check if game has started
                        if (result.game && result.game.status === 'playing') {
                            clearInterval(lobbyInterval);
                            startGame();
                        }
                    }
                }, 3000);
            }
            
            async function startGame() {
                if (isHost) {
                    // Call backend to start the game
                    const result = await callBackend('startGame', {
                        gameCode: gameCode
                    });
                    
                    if (!result.success) return;
                }
                
                // For all players, show the game section
                showSection('game-section');
                
                // Start the game timer
                startGameTimer();
                
                showStatus(translations[currentLanguage]['game_started'], 'success');
            }
            
            function startCancelCountdown() {
                if (!isHost) return;
                
                cancelTimer.style.display = 'block';
                timeLeft = 30;
                timerValue.textContent = timeLeft;
                
                // Show warning
                showStatus(translations[currentLanguage]['cancellation_warning'], 'error');
                
                // Start countdown
                clearInterval(timer);
                timer = setInterval(() => {
                    timeLeft--;
                    timerValue.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        cancelGame();
                    }
                }, 1000);
            }
            
            async function cancelGame() {
                clearInterval(timer);
                
                // Call backend to cancel the game
                await callBackend('cancelGame', {
                    gameCode: gameCode
                });
                
                showSection('host-section');
                showStatus(translations[currentLanguage]['game_cancelled'], 'info');
            }
            
            function startGameTimer() {
                gameTime = 180;
                gameTimerValue.textContent = gameTime;
                
                clearInterval(gameTimer);
                gameTimer = setInterval(() => {
                    gameTime--;
                    gameTimerValue.textContent = gameTime;
                    
                    if (gameTime <= 0) {
                        clearInterval(gameTimer);
                        showStatus(translations[currentLanguage]['time_up'], 'error');
                    }
                }, 1000);
            }
            
            async function submitAnswers() {
                // Get all answers
                const answers = {
                    boyName: document.getElementById('boy-name').value.trim(),
                    girlName: document.getElementById('girl-name').value.trim(),
                    fruit: document.getElementById('fruit').value.trim(),
                    vegetable: document.getElementById('vegetable').value.trim(),
                    object: document.getElementById('object').value.trim(),
                    animal: document.getElementById('animal').value.trim(),
                    profession: document.getElementById('profession').value.trim(),
                    city: document.getElementById('city').value.trim(),
                    country: document.getElementById('country').value.trim(),
                    clothing: document.getElementById('clothing').value.trim()
                };
                
                // Validate that all answers are filled
                let allFilled = true;
                for (const key in answers) {
                    if (!answers[key]) {
                        allFilled = false;
                        break;
                    }
                }
                
                if (!allFilled) {
                    showStatus(translations[currentLanguage]['fill_all'], 'error');
                    return;
                }
                
                // Call backend to submit answers
                const result = await callBackend('submitAnswers', {
                    gameCode: gameCode,
                    playerName: playerName,
                    ...answers
                });
                
                if (!result.success) return;
                
                // Display answers
                displayAnswers(answers);
                
                // Show answers section
                answersDisplay.style.display = 'block';
                
                // Mark player as submitted
                markPlayerSubmitted(playerName);
                
                // Show notification to self
                showNotification(playerName, true);
                
                // In a real app, we would notify other players here
                // For demo purposes, we'll simulate notifications for other players
                setTimeout(() => {
                    players.filter(p => p !== playerName).forEach(p => {
                        showNotification(p);
                        markPlayerSubmitted(p);
                    });
                }, 2000);
                
                // Scroll to answers
                answersDisplay.scrollIntoView({ behavior: 'smooth' });
                
                showStatus(translations[currentLanguage]['answers_submitted'], 'success');
            }
            
            function displayAnswers(answers) {
                answersGrid.innerHTML = '';
                
                const categories = [
                    { id: 'boyName', name: translations[currentLanguage]['boys_name'], icon: 'fas fa-male' },
                    { id: 'girlName', name: translations[currentLanguage]['girls_name'], icon: 'fas fa-female' },
                    { id: 'fruit', name: translations[currentLanguage]['fruit'], icon: 'fas fa-apple-alt' },
                    { id: 'vegetable', name: translations[currentLanguage]['vegetable'], icon: 'fas fa-carrot' },
                    { id: 'object', name: translations[currentLanguage]['object'], icon: 'fas fa-couch' },
                    { id: 'animal', name: translations[currentLanguage]['animal'], icon: 'fas fa-paw' },
                    { id: 'profession', name: translations[currentLanguage]['profession'], icon: 'fas fa-briefcase' },
                    { id: 'city', name: translations[currentLanguage]['city'], icon: 'fas fa-city' },
                    { id: 'country', name: translations[currentLanguage]['country'], icon: 'fas fa-globe-americas' },
                    { id: 'clothing', name: translations[currentLanguage]['clothing'], icon: 'fas fa-tshirt' }
                ];
                
                for (const category of categories) {
                    const answerCard = document.createElement('div');
                    answerCard.className = 'answer-card';
                    answerCard.innerHTML = `
                        <h4><i class="${category.icon}"></i> ${category.name}</h4>
                        <p>${answers[category.id]}</p>
                    `;
                    answersGrid.appendChild(answerCard);
                }
            }
        });
    </script>
</body>
</html>